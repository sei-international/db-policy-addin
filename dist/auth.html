<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
  <title>Authenticating…</title>
</head>
<body>
<script>
  // 1) MSAL config
  const msalInstance = new msal.PublicClientApplication({
    auth: {
      clientId: "2aa8453b-2c60-4d91-baeb-8a920b648453",
      authority: "https://login.microsoftonline.com/3dfe125d-a589-44af-9fc7-113f3bff5873",
      redirectUri: window.location.origin + "/auth.html",
      navigateToLoginRequestUrl: false
    }
  });

  // 2) Office dialog context
  Office.initialize = () => {
    msalInstance.handleRedirectPromise()
      .then(response => {
        if (response && response.accessToken) {
          // Send token back to taskpane and close dialog
          Office.context.ui.messageParent(JSON.stringify({
            type: "token",
            token: response.accessToken
          }));
        } else {
          // No token yet → kick off loginRedirect
          msalInstance.loginRedirect({
            scopes: ["api://99b30329-bfd7-4066-a351-503f6b025619/access_as_user"]
          });
        }
      })
      .catch(err => {
        Office.context.ui.messageParent(JSON.stringify({
          type: "error",
          error: err.errorMessage || err.toString()
        }));
      });
  };
</script>
</body>
</html>
