<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="taskpane.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Excel DB Connector</title>
</head>
<body data-theme="light">
  <div class="header">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M4 4h16v4H4zM4 10h16v4H4zM4 16h16v4H4z" />
    </svg>
    <span>Policies Database Connector</span>
  </div>

  <div class="tabs">
    <div id="tab-connect" class="tab active">Login</div>
    <div id="tab-pull"    class="tab disabled">Database</div>
    <div id="tab-faq"    class="tab">FAQ</div>
  </div>
  
  <div id="panel-connect" class="content" style="display:block;">
    <form id="connectForm" class="login-form">
      <button type="submit" id="connectBtn">Sign in with Microsoft</button>
      <div id="connectStatus"></div>
      <div id="loadingContainer" class="hidden">
        <div id="spinner" class="spinner"></div>
        <span id="loadingMessage"></span>
      </div>
    </form>
    
  </div>
  
  
  <div id="panel-pull" class="content" style="display:none;">
    <h2>Pull Data</h2>
    <p>Select which sheets you would like to get data for. To save all of your edits and upload them to the database, click "Push all changes". You can always make modifications after pushing.</p>
    <div class="controls">
        <div id="tableCheckboxContainer"></div>
        <div class="tooltip-container">
        <button id="pull">Pull</button>
        <span class="tooltip-text">Pull data from the database into this workbook. This will not have any effect on the content of the database.</span>
      </div>
      </div>
      <div class="tooltip-container">
        <button id="push" >Push All Changes</button>
        <span class="tooltip-text">Push your edits into the database. This will push ALL changes from EVERY worksheet you've modified that is connected to a database table. Please be sure to double check your changes before pushing. You can revisit and edit any fields after pushing.</span>
      </div>
      <div id="status"></div>
      <div id="confirmDialog" class="confirm-modal">
        <div class="confirm-content">
          <p id="confirmMessage"></p>
          <button id="confirmYes">Yes</button>
          <button id="confirmNo">No</button>
        </div>
      </div>
    
      <div id="reminderModal" class="reminder-modal">
        <div class="reminder-content">
          <h1>‚è∞ Reminder</h1>
          <p>It has been 30 minutes since your last push. You may have un-pushed changes.</p>
          <button id="closeReminder">Got it</button>
        </div>
      </div>
  </div>

  <div id="panel-faq" class="content" style="display:none;">
    <h2>FAQ and Usage</h2>
    <div class="usage-instructions">
      <h3>How to Use</h3>
      <ol>
        <li><strong>Login</strong>: Go to the <em>Login</em> tab, enter your credentials, then click <strong>Connect</strong>.</li>
        <li><strong>Pull All Data</strong>: In the <em>Database</em> tab, select one or more tables and click <strong>Pull</strong>. This will create a separate sheet for each table you pull, plus an additional sheet with country grouping info for your use. These sheets can interact directly with the database; <strong>do not put any equations within the highlighted tables</strong></li>
        <li><strong>Push Data</strong>: After editing data in Excel, click <strong>Push</strong> to send ALL changes back to the database. <strong>This will push your changes from every sheet you modify</strong>. Please note that you will only be able to modify Country, Policy Date Year, Policy Name, Policy Type, or Last Modified columns from the policies table.</li>
        <li><strong>Auto-Reminders</strong>: If you have un-pushed changes, a reminder modal appears every 30 minutes. If you do not click push, none of your edits will be saved to the database. It is best to frequently push so that the software can warn you of any conflicts or errors.</li>
      </ol>
    </div>
    <div class="faq-item">
      <details>
        <summary>How do I connect to the database?</summary>
        <p>Go to the Login tab, enter your username and password, then click Connect.</p>
      </details>
      <details>
        <summary>How do I pull data?</summary>
        <p>Switch to the Database tab, select your desired tables, and click Pull. Use Pull One to pull the metadata for a single document code. A new sheet will be created for each table you pull.</p>
      </details>
      <details>
        <summary>How do I save my data?</summary>
        <p>When you click "push", all of your changes will be uploaded to the database. Then, next time you login an pull, your changes will be available. All changes can be edited at any point after a push, EXCEPT for the document code.</p>
      </details>
      <details>
        <summary>Where can I find help?</summary>
        <p>For more information on the policies database, contact miquel.munozcabre@sei.org. For technical problems using this tool, contact julia.weppler@sei.org.</p>
      </details>
    </div>
  </div>


  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script src="taskpane.js"></script>

</body>
</html>
